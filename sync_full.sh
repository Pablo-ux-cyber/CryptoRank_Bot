#!/bin/bash

# Полный скрипт синхронизации с GitHub с обработкой конфликтов
# Настраивает Git и автоматически решает проблему расходящихся веток

echo "=== Полная синхронизация с GitHub ==="
echo "Дата: $(date)"
echo ""

# Проверка, что мы находимся в нужной директории
if [ ! -d ".git" ]; then
    echo "Ошибка: скрипт должен быть запущен из корневой директории репозитория!"
    exit 1
fi

# Настройка стратегии для git pull
git config pull.rebase false
echo "Git настроен на использование merge strategy"

# Получение текущего состояния
echo "Состояние репозитория до синхронизации:"
git status -s
echo ""

# Сохранение локальных изменений
echo "Сохранение локальных изменений..."
git stash -u

# Получение последней версии с GitHub
echo "Получение последних изменений с GitHub..."
git pull --no-rebase

# Применение сохраненных изменений
echo "Восстановление локальных изменений..."
git stash pop || echo "Нет сохраненных изменений или возникли конфликты"

echo ""
echo "=== Синхронизация завершена ==="
echo "Текущие изменения:"
git status -s

echo ""
echo "Для продолжения тестирования Google Trends выполните:"
echo "python test_google_trends.py --force"