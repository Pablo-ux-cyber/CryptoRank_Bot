<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MA200 Market Indicator - –ö—Ä–∏–ø—Ç–æ-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä—ã–Ω–æ—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .signal-emoji {
            font-size: 2rem;
            margin-right: 10px;
        }
        .market-signal {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .signal-red { background-color: rgba(220, 53, 69, 0.2); }
        .signal-orange { background-color: rgba(253, 126, 20, 0.2); }
        .signal-yellow { background-color: rgba(255, 193, 7, 0.2); }
        .signal-green { background-color: rgba(40, 167, 69, 0.2); }
        .signal-blue { background-color: rgba(13, 110, 253, 0.2); }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-cached { background-color: #ffc107; }
        .status-realtime { background-color: #28a745; }
        .chart-container {
            position: relative;
            width: 100%;
            max-height: 500px;
            margin: 20px 0;
        }
        .ma200-chart {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }
        .loading-spinner {
            display: none;
        }
        .error-message {
            color: #ff6b6b;
            background-color: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .progress-bar-custom {
            height: 20px;
            border-radius: 10px;
            background: linear-gradient(90deg, #2ed573 0%, #ffa502 50%, #ff4757 100%);
        }
        .threshold-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background-color: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="display-6">üìä MA200 Market Indicator</h1>
                    <div>
                        <a href="/" class="btn btn-outline-light me-2">‚Üê –ì–ª–∞–≤–Ω–∞—è</a>
                        <button class="btn btn-primary me-2" id="get-data-btn" onclick="getMA200Data()">
                            <i class="fas fa-chart-line me-2"></i>Get MA200 Data
                        </button>
                        <button class="btn btn-warning me-2" id="refresh-btn" onclick="refreshAllCoins()">
                            <i class="fas fa-sync-alt me-2"></i>Refresh All 50 Coins
                        </button>
                        <button class="btn btn-info" id="status-btn" onclick="checkRefreshStatus()">
                            <i class="fas fa-info-circle me-2"></i>Status
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress indicator for background refresh -->
        <div id="progressContainer" class="mb-4" style="display: none;">
            <div class="alert alert-info">
                <h5><i class="fas fa-spinner fa-spin me-2"></i>Refreshing All 50 Coins</h5>
                <div class="progress">
                    <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%"></div>
                </div>
                <p id="progressText" class="mt-2 mb-0">Starting refresh...</p>
            </div>
        </div>

        {% if error %}
        <div class="row">
            <div class="col-12">
                <div class="error-message">
                    <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h5>
                    <p>{{ error }}</p>
                    <button class="btn btn-warning" onclick="getMA200Data()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                </div>
            </div>
        </div>
        {% endif %}

        {% if ma200_data %}
        <div class="row mb-4">
            <div class="col-12">
                <!-- –¢–µ–∫—É—â–∏–π —Å–∏–≥–Ω–∞–ª -->
                <div class="card metric-card">
                    <div class="card-body">
                        <div class="market-signal signal-{{ 'red' if ma200_data.signal == 'üî¥' else 'orange' if ma200_data.signal == 'üü†' else 'yellow' if ma200_data.signal == 'üü°' else 'green' if ma200_data.signal == 'üü¢' else 'blue' }}">
                            <div class="signal-emoji">{{ ma200_data.signal }}</div>
                            <div>
                                <h3 class="mb-1">{{ ma200_data.status }}</h3>
                                <p class="mb-0">{{ ma200_data.description }}</p>
                                <small class="text-light">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {{ ma200_data.date }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">üìà –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h2 class="text-primary mb-1">{{ ma200_data.percentage }}%</h2>
                            <p class="text-muted mb-2">–º–æ–Ω–µ—Ç –≤—ã—à–µ MA{{ ma200_data.ma_period }}</p>
                            <div class="progress mb-2">
                                <div class="progress-bar" role="progressbar" 
                                     style="width: {{ ma200_data.percentage }}%; background: {% if ma200_data.percentage <= ma200_data.oversold_threshold %}#2ed573{% elif ma200_data.percentage >= ma200_data.overbought_threshold %}#ff4757{% else %}#ffa502{% endif %};"
                                     aria-valuenow="{{ ma200_data.percentage }}" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                </div>
                            </div>
                        </div>
                        
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                –ú–æ–Ω–µ—Ç –≤—ã—à–µ MA{{ ma200_data.ma_period }}
                                <span class="badge bg-success rounded-pill">{{ ma200_data.coins_above_ma200 }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                –í—Å–µ–≥–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
                                <span class="badge bg-secondary rounded-pill">{{ ma200_data.total_coins }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                –ü–µ—Ä–∏–æ–¥ MA
                                <span class="badge bg-info rounded-pill">{{ ma200_data.ma_period }} –¥–Ω–µ–π</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                –¢–æ–ø –º–æ–Ω–µ—Ç
                                <span class="badge bg-warning rounded-pill">{{ ma200_data.top_n }}</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- –ì—Ä–∞—Ñ–∏–∫ -->
            <div class="col-md-8">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">üìä –ì—Ä–∞—Ñ–∏–∫ MA200 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞</h5>
                        <div>
                            <a href="/api/ma200/chart" target="_blank" class="btn btn-sm btn-outline-primary me-2">–û—Ç–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫</a>
                            <a href="/api/ma200/download-csv" class="btn btn-sm btn-outline-success">–°–∫–∞—á–∞—Ç—å CSV</a>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            {% if ma200_data.chart_path %}
                            <img src="/api/ma200/chart" alt="MA200 Indicator Chart" class="ma200-chart" />
                            {% else %}
                            <div class="text-center text-muted py-5">
                                <i class="fas fa-chart-line fa-3x mb-3"></i>
                                <p>–ì—Ä–∞—Ñ–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è.</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–æ—Ä–æ–≥–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏ -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">üéØ –ü–æ—Ä–æ–≥–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group">
                            <li class="list-group-item d-flex">
                                <div class="me-2">üî¥</div>
                                <div>
                                    <strong>–ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å (‚â§{{ ma200_data.oversold_threshold }}%)</strong><br>
                                    <small class="text-muted">–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –Ω–∏–∂–µ MA200 - –≤–æ–∑–º–æ–∂–Ω–∞—è —Ç–æ—á–∫–∞ –ø–æ–∫—É–ø–∫–∏</small>
                                </div>
                            </li>
                            <li class="list-group-item d-flex">
                                <div class="me-2">üü†</div>
                                <div>
                                    <strong>–°–ª–∞–±—ã–π —Ä—ã–Ω–æ–∫ ({{ ma200_data.oversold_threshold + 1 }}-30%)</strong><br>
                                    <small class="text-muted">–ú–∞–ª–æ –º–æ–Ω–µ—Ç –≤—ã—à–µ MA200 - –º–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥</small>
                                </div>
                            </li>
                            <li class="list-group-item d-flex">
                                <div class="me-2">üü°</div>
                                <div>
                                    <strong>–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫ (31-69%)</strong><br>
                                    <small class="text-muted">–£–º–µ—Ä–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –≤—ã—à–µ MA200</small>
                                </div>
                            </li>
                            <li class="list-group-item d-flex">
                                <div class="me-2">üü¢</div>
                                <div>
                                    <strong>–°–∏–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫ (70-{{ ma200_data.overbought_threshold - 1 }}%)</strong><br>
                                    <small class="text-muted">–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –≤—ã—à–µ MA200 - –±—ã—á–∏–π —Ç—Ä–µ–Ω–¥</small>
                                </div>
                            </li>
                            <li class="list-group-item d-flex">
                                <div class="me-2">üîµ</div>
                                <div>
                                    <strong>–ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å (‚â•{{ ma200_data.overbought_threshold }}%)</strong><br>
                                    <small class="text-muted">–ü–æ—á—Ç–∏ –≤—Å–µ –º–æ–Ω–µ—Ç—ã –≤—ã—à–µ MA200 - –≤–æ–∑–º–æ–∂–Ω–∞—è —Ç–æ—á–∫–∞ –ø—Ä–æ–¥–∞–∂–∏</small>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">‚ÑπÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>MA200 Market Indicator</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç —Ç–æ–ø-{{ ma200_data.top_n }} –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç —Ç–æ—Ä–≥—É–µ—Ç—Å—è –≤—ã—à–µ —Å–≤–æ–µ–π 200-–¥–Ω–µ–≤–Ω–æ–π —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π.</p>
                        
                        <h6>–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:</h6>
                        <ul>
                            <li>–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Ç–æ–ø-{{ ma200_data.top_n }} –º–æ–Ω–µ—Ç –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏</li>
                            <li>–î–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è MA{{ ma200_data.ma_period }} –Ω–∞ –æ—Å–Ω–æ–≤–µ {{ ma200_data.ma_period }} –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–Ω–µ–π</li>
                            <li>–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ —Å MA{{ ma200_data.ma_period }}</li>
                            <li>–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç –º–æ–Ω–µ—Ç –≤—ã—à–µ MA{{ ma200_data.ma_period }}</li>
                        </ul>
                        
                        <h6>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:</h6>
                        <ul>
                            <li><strong>–í—ã—Å–æ–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (>{{ ma200_data.overbought_threshold }}%)</strong> —á–∞—Å—Ç–æ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –ø–∏–∫–∏ —Ä—ã–Ω–∫–∞</li>
                            <li><strong>–ù–∏–∑–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (<{{ ma200_data.oversold_threshold }}%)</strong> –º–æ–≥—É—Ç —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –ø–æ–∫—É–ø–∫–∏</li>
                            <li>–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –æ–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–≥–æ —Ä—ã–Ω–∫–∞</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö -->
        {% if history_data %}
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">üìÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ</h5>
                        <small class="text-muted">–ü–æ–∫–∞–∑–∞–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</small>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã—à–µ MA200</th>
                                        <th>–ú–æ–Ω–µ—Ç –≤—ã—à–µ MA200</th>
                                        <th>–í—Å–µ–≥–æ –º–æ–Ω–µ—Ç</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for record in history_data %}
                                    <tr>
                                        <td>{{ record.date }}</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="progress me-2" style="width: 60px; height: 20px;">
                                                    <div class="progress-bar" 
                                                         style="width: {{ record.percentage }}%; background: {% if record.percentage <= ma200_data.oversold_threshold %}#2ed573{% elif record.percentage >= ma200_data.overbought_threshold %}#ff4757{% else %}#ffa502{% endif %};"
                                                         role="progressbar">
                                                    </div>
                                                </div>
                                                <span>{{ "%.1f"|format(record.percentage) }}%</span>
                                            </div>
                                        </td>
                                        <td>{{ record.coins_above_ma200 }}</td>
                                        <td>{{ record.total_coins }}</td>
                                        <td>
                                            {% if record.percentage <= ma200_data.oversold_threshold %}
                                            <span class="badge bg-success">–ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å</span>
                                            {% elif record.percentage >= ma200_data.overbought_threshold %}
                                            <span class="badge bg-danger">–ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å</span>
                                            {% elif record.percentage <= 30 %}
                                            <span class="badge bg-warning">–°–ª–∞–±—ã–π —Ä—ã–Ω–æ–∫</span>
                                            {% elif record.percentage >= 70 %}
                                            <span class="badge bg-info">–°–∏–ª—å–Ω—ã–π —Ä—ã–Ω–æ–∫</span>
                                            {% else %}
                                            <span class="badge bg-secondary">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% else %}
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center py-5">
                        <h3 class="text-muted mb-3">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö MA200 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞</h3>
                        <p class="text-muted">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</p>
                        <button class="btn btn-primary" onclick="getMA200Data()">–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ MA200</button>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Get MA200 data (uses cache if available)
        function getMA200Data() {
            const getBtn = document.getElementById('get-data-btn');
            getBtn.disabled = true;
            getBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Loading...';
            
            fetch('/api/ma200')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error loading data');
            })
            .finally(() => {
                getBtn.disabled = false;
                getBtn.innerHTML = '<i class="fas fa-chart-line me-2"></i>Get MA200 Data';
            });
        }
        
        // Start background refresh of all 50 coins
        function refreshAllCoins() {
            const refreshBtn = document.getElementById('refresh-btn');
            refreshBtn.disabled = true;
            refreshBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Starting...';
            
            fetch('/api/ma200/refresh', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'started') {
                    showProgressIndicator();
                    startProgressMonitoring();
                    alert('Background refresh started for all 50 coins. This will take 2-3 minutes.');
                } else if (data.status === 'already_running') {
                    alert('Refresh already in progress: ' + data.message);
                    showProgressIndicator();
                    startProgressMonitoring();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error starting refresh');
            })
            .finally(() => {
                refreshBtn.disabled = false;
                refreshBtn.innerHTML = '<i class="fas fa-sync-alt me-2"></i>Refresh All 50 Coins';
            });
        }
        
        // Check refresh status
        function checkRefreshStatus() {
            fetch('/api/ma200/status')
            .then(response => response.json())
            .then(data => {
                if (data.running) {
                    alert(`Refresh in progress. Progress: ${data.progress}/${data.total}`);
                    showProgressIndicator();
                    startProgressMonitoring();
                } else if (data.completed_at) {
                    const completedTime = new Date(data.completed_at * 1000).toLocaleTimeString();
                    alert(`Last refresh completed at: ${completedTime}`);
                } else {
                    alert('No refresh currently running.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error checking status');
            });
        }
        
        // Show progress indicator
        function showProgressIndicator() {
            document.getElementById('progressContainer').style.display = 'block';
        }
        
        // Hide progress indicator
        function hideProgressIndicator() {
            document.getElementById('progressContainer').style.display = 'none';
        }
        
        // Start monitoring progress
        function startProgressMonitoring() {
            const progressInterval = setInterval(() => {
                fetch('/api/ma200/status')
                .then(response => response.json())
                .then(data => {
                    if (data.running) {
                        const progressPercent = Math.round((data.progress / data.total) * 100);
                        document.getElementById('progressBar').style.width = progressPercent + '%';
                        document.getElementById('progressText').textContent = 
                            `Processing coin ${data.progress}/${data.total} (${progressPercent}%)`;
                    } else {
                        clearInterval(progressInterval);
                        hideProgressIndicator();
                        if (data.completed_at) {
                            alert('Refresh completed! Click "Get MA200 Data" to see updated results.');
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    clearInterval(progressInterval);
                    hideProgressIndicator();
                });
            }, 2000); // Check every 2 seconds
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        // setInterval(refreshMA200Data, 5 * 60 * 1000);
    </script>
</body>
</html>